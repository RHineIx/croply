<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>استوديو المعاملات الذكي</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-slate-50 text-slate-800 font-['Cairo']">

    <header class="bg-white shadow-sm sticky top-0 z-50 no-print">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <span class="material-symbols-rounded text-blue-600 text-3xl">photo_camera_front</span>
                <h1 class="text-xl font-bold text-gray-800">استوديو المعاملات</h1>
            </div>
            <button onclick="location.reload()" class="text-sm text-gray-500 hover:text-blue-600 flex items-center gap-1">
                <span class="material-symbols-rounded">restart_alt</span>
                <span class="hidden sm:inline">بدء جديد</span>
            </button>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 min-h-screen">

        <section id="step-1" class="max-w-4xl mx-auto fade-in">
            <div class="text-center mb-10">
                <h2 class="text-2xl md:text-3xl font-bold mb-3 text-slate-800">اختر نوع الصورة المطلوبة</h2>
                <p class="text-slate-500">مقاسات رسمية معتمدة للدوائر الحكومية</p>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
                <div class="card-option group" onclick="selectSize(40, 60, 'جواز سفر')">
                    <div class="icon-box bg-blue-100 text-blue-600 group-hover:bg-blue-600 group-hover:text-white transition">
                        <span class="material-symbols-rounded text-4xl">airplane_ticket</span>
                    </div>
                    <h3 class="text-lg font-bold">جواز سفر (قياسي)</h3>
                    <p class="text-sm text-gray-500">4 × 6 سم</p>
                </div>

                <div class="card-option group" onclick="selectSize(35, 45, 'معاملات رسمية')">
                    <div class="icon-box bg-green-100 text-green-600 group-hover:bg-green-600 group-hover:text-white transition">
                        <span class="material-symbols-rounded text-4xl">badge</span>
                    </div>
                    <h3 class="text-lg font-bold">هوية / معاملات</h3>
                    <p class="text-sm text-gray-500">3.5 × 4.5 سم</p>
                </div>

                <div class="card-option group" onclick="selectSize(50, 50, 'تأشيرة فيزا')">
                    <div class="icon-box bg-purple-100 text-purple-600 group-hover:bg-purple-600 group-hover:text-white transition">
                        <span class="material-symbols-rounded text-4xl">public</span>
                    </div>
                    <h3 class="text-lg font-bold">تأشيرة (فيزا)</h3>
                    <p class="text-sm text-gray-500">5 × 5 سم</p>
                </div>
            </div>
            
            <div class="mt-8 text-center">
                <div class="flex justify-center gap-2 items-center flex-wrap">
                    <span class="text-sm text-gray-400">مخصص (ملم):</span>
                    <input type="number" id="customW" placeholder="العرض" class="p-2 border rounded w-20 text-center">
                    <span class="text-gray-300">×</span>
                    <input type="number" id="customH" placeholder="الطول" class="p-2 border rounded w-20 text-center">
                    <button onclick="selectCustomSize()" class="bg-gray-800 text-white px-4 py-2 rounded hover:bg-black">تطبيق</button>
                </div>
            </div>
        </section>

        <section id="step-2" class="max-w-2xl mx-auto hidden fade-in">
            <div class="bg-white p-4 md:p-6 rounded-2xl shadow-lg">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-lg">ضبط الصورة (<span id="selected-size-label"></span>)</h3>
                    <button onclick="resetApp()" class="text-red-500 text-sm">تغيير</button>
                </div>

                <div id="upload-area" class="border-2 border-dashed border-gray-300 rounded-xl p-6 md:p-10 text-center cursor-pointer hover:bg-gray-50 transition" onclick="document.getElementById('fileInput').click()">
                    <span class="material-symbols-rounded text-6xl text-gray-300 mb-2">cloud_upload</span>
                    <p class="font-bold text-gray-600">اضغط لرفع الصورة</p>
                    <input type="file" id="fileInput" accept="image/*" hidden onchange="loadImage(event)">
                </div>

                <div id="crop-container" class="hidden relative h-64 md:h-96 bg-gray-900 rounded-lg overflow-hidden mb-4">
                    <img id="image-to-crop" src="" alt="Crop Preview" style="max-width: 100%;">
                </div>

                <div id="crop-actions" class="hidden flex gap-3 mt-4">
                    <button onclick="processImage()" class="flex-1 bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 flex justify-center items-center gap-2 shadow-lg shadow-blue-200">
                        <span class="material-symbols-rounded">check</span>
                        <span class="hidden sm:inline">اعتماد ومتابعة</span>
                        <span class="sm:hidden">متابعة</span>
                    </button>
                    <button onclick="resetUpload()" class="px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-100">إلغاء</button>
                </div>
            </div>
        </section>

        <section id="step-3" class="hidden fade-in">
            <div class="flex flex-col lg:flex-row gap-6 items-start justify-center">
                
                <div class="w-full lg:w-80 bg-white p-5 rounded-2xl shadow-lg no-print relative lg:sticky lg:top-24 z-40">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2 border-b pb-2">
                        <span class="material-symbols-rounded text-blue-600">tune</span>
                        خصائص الطباعة
                    </h3>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-4 mb-4">
                        <div>
                            <label class="text-sm font-semibold text-gray-600 mb-2 block">نوع الإطار</label>
                            <div class="flex gap-2">
                                <button onclick="setBorder('dashed')" class="border-btn active" data-type="dashed">
                                    <div class="w-5 h-5 border border-dashed border-gray-400 rounded"></div>
                                </button>
                                <button onclick="setBorder('solid')" class="border-btn" data-type="solid">
                                    <div class="w-5 h-5 border border-gray-400 rounded"></div>
                                </button>
                                <button onclick="setBorder('corner')" class="border-btn" data-type="corner">
                                    <span class="material-symbols-rounded text-gray-500 text-lg">crop_free</span>
                                </button>
                                <button onclick="setBorder('wavy')" class="border-btn" data-type="wavy">
                                    <span class="material-symbols-rounded text-gray-500 text-lg">waves</span>
                                </button>
                            </div>
                        </div>

                        <div>
                             <label class="text-sm font-semibold text-gray-600 mb-2 block">العدد: <span id="countDisplay" class="text-blue-600 font-bold">8</span></label>
                             <input type="range" id="countRange" min="1" max="12" value="8" oninput="updateCount(this.value)" class="w-full accent-blue-600 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>
                    </div>

                    <div class="flex flex-col gap-2 mt-4 pt-4 border-t">
                        <button onclick="window.print()" class="w-full bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700 shadow-lg shadow-green-200 flex justify-center items-center gap-2">
                            <span class="material-symbols-rounded">print</span>
                            طباعة / حفظ PDF
                        </button>
                        
                        <button onclick="resetApp()" class="w-full bg-gray-100 text-gray-700 py-3 rounded-xl font-bold hover:bg-gray-200">
                            صورة جديدة
                        </button>
                    </div>
                </div>

                <div class="print-container z-10">
                    <div id="print-sheet" class="a4-sheet">
                        </div>
                </div>

            </div>
        </section>

    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script src="script.js"></script>
</body>
</html>