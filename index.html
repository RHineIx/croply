<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>استوديو المعاملات الذكي</title>

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-slate-50 text-slate-800 font-['Cairo']">

    <header class="bg-white shadow-sm sticky top-0 z-50 no-print">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <span class="material-symbols-rounded text-blue-600 text-3xl">photo_camera_front</span>
                <h1 class="text-xl font-bold text-gray-800">استوديو المعاملات</h1>
            </div>
            <button id="btn-reload" class="text-sm text-gray-500 hover:text-blue-600 flex items-center gap-1 transition-colors">
                <span class="material-symbols-rounded">restart_alt</span>
                <span class="hidden sm:inline">بدء جديد</span>
            </button>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 min-h-screen relative">
        
        <div id="toast-container" class="fixed top-24 left-1/2 transform -translate-x-1/2 z-[60] flex flex-col gap-2 pointer-events-none w-full max-w-sm px-4"></div>

        <section id="step-1" class="max-w-4xl mx-auto fade-in">
            <div class="text-center mb-10">
                <h2 class="text-2xl md:text-3xl font-bold mb-3 text-slate-800">اختر نوع الصورة المطلوبة</h2>
                <p class="text-slate-500">مقاسات رسمية معتمدة للدوائر الحكومية</p>
            </div>

            <div id="sizes-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
                </div>

            <div class="mt-8 text-center border-t pt-8">
                <p class="text-gray-500 mb-4 text-sm">أو أدخل مقاساً مخصصاً</p>
                <div class="flex justify-center gap-2 items-center flex-wrap">
                    <span class="text-sm text-gray-400">العرض (ملم):</span>
                    <input type="number" id="customW" placeholder="مثلاً: 35" class="p-2 border rounded w-24 text-center focus:ring-2 focus:ring-blue-500 outline-none transition">
                    <span class="text-gray-300">×</span>
                    <span class="text-sm text-gray-400">الطول (ملم):</span>
                    <input type="number" id="customH" placeholder="مثلاً: 45" class="p-2 border rounded w-24 text-center focus:ring-2 focus:ring-blue-500 outline-none transition">
                    <button id="btn-custom-size" class="bg-gray-800 text-white px-6 py-2 rounded hover:bg-black transition shadow-lg">تطبيق</button>
                </div>
            </div>
        </section>

        <section id="step-2" class="max-w-2xl mx-auto hidden fade-in">
            <div class="bg-white p-4 md:p-6 rounded-2xl shadow-lg">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-lg">ضبط الصورة (<span id="selected-size-label"></span>)</h3>
                    <button id="btn-change-size" class="text-red-500 text-sm hover:bg-red-50 px-2 py-1 rounded transition-colors">تغيير المقاس</button>
                </div>

                <div id="upload-area" class="border-2 border-dashed border-gray-300 rounded-xl p-6 md:p-10 text-center cursor-pointer hover:bg-gray-50 transition relative">
                    <div class="pointer-events-none">
                        <span class="material-symbols-rounded text-6xl text-blue-200 mb-2">cloud_upload</span>
                        <p class="font-bold text-gray-600">اضغط لرفع الصورة</p>
                        <p class="text-sm text-gray-400 mt-1">أو اسحب الملف وأفلته هنا</p>
                    </div>
                    <input type="file" id="fileInput" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                </div>

                <div id="crop-container" class="hidden">
                    <div class="relative h-64 md:h-96 bg-gray-900 rounded-lg overflow-hidden mb-4 disable-touch-callout">
                        <img id="image-to-crop" src="" alt="Crop Preview" style="max-width: 100%;">
                    </div>

                    <div class="flex justify-center gap-4 mb-4">
                        <button id="btn-rotate-left" class="text-gray-600 hover:text-blue-600 flex flex-col items-center text-xs gap-1 transition-colors">
                            <span class="material-symbols-rounded text-2xl bg-gray-100 p-2 rounded-full">rotate_left</span>
                            تدوير يسار
                        </button>
                        <button id="btn-rotate-right" class="text-gray-600 hover:text-blue-600 flex flex-col items-center text-xs gap-1 transition-colors">
                            <span class="material-symbols-rounded text-2xl bg-gray-100 p-2 rounded-full">rotate_right</span>
                            تدوير يمين
                        </button>
                    </div>
                </div>

                <div id="crop-actions" class="hidden flex gap-3 mt-6 border-t pt-4">
                    <button id="btn-process" class="flex-1 bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 flex justify-center items-center gap-2 shadow-lg shadow-blue-200 transition">
                        <span class="material-symbols-rounded">check_circle</span>
                        <span class="hidden sm:inline">اعتماد ومتابعة</span>
                        <span class="sm:hidden">متابعة</span>
                    </button>
                    <button id="btn-cancel-upload" class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-100 font-medium text-gray-600 transition-colors">إلغاء الصورة</button>
                </div>
            </div>
        </section>

        <section id="step-3" class="hidden fade-in">
            <div class="flex flex-col lg:flex-row gap-6 items-start justify-center">

                <div class="w-full lg:w-80 bg-white p-5 rounded-2xl shadow-lg no-print relative lg:sticky lg:top-24 z-40">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2 border-b pb-2">
                        <span class="material-symbols-rounded text-blue-600">tune</span>
                        خصائص الطباعة
                    </h3>

                    <div class="space-y-4">
                        <div>
                            <label class="text-sm font-semibold text-gray-600 mb-2 block">نوع الإطار</label>
                            <div class="flex gap-2">
                                <button class="border-btn active" data-type="dashed" title="متقطع">
                                    <div class="w-5 h-5 border border-dashed border-gray-400 rounded"></div>
                                </button>
                                <button class="border-btn" data-type="solid" title="متصل">
                                    <div class="w-5 h-5 border border-gray-400 rounded"></div>
                                </button>
                                <button class="border-btn" data-type="corner" title="زوايا">
                                    <span class="material-symbols-rounded text-gray-500 text-lg">crop_free</span>
                                </button>
                                <button class="border-btn" data-type="none" title="بدون إطار">
                                    <span class="material-symbols-rounded text-gray-500 text-lg">block</span>
                                </button>
                            </div>
                        </div>

                        <div>
                             <div class="flex justify-between items-center mb-2">
                                 <label class="text-sm font-semibold text-gray-600">العدد المطلوب</label>
                                 <span id="countDisplay" class="bg-blue-100 text-blue-600 px-2 py-0.5 rounded text-sm font-bold">8</span>
                             </div>
                             <input type="range" id="countRange" min="1" max="30" value="8" class="w-full accent-blue-600 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>

                        <div class="mt-4 border-t pt-4">
                            <h4 class="font-bold text-md mb-2">الهامش الداخلي (من حافة الورقة)</h4>
                            <input id="marginRange" type="range" min="0" max="20" value="5" class="w-full accent-blue-600 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                            <p class="text-sm text-gray-500 mt-1">الهامش: <span id="marginValue">5</span> مم</p>
                        </div>

                        <div class="mt-4 border-t pt-4">
                            <h4 class="font-bold text-md mb-3">موضع الطباعة داخل الورقة</h4>
                            <div class="grid grid-cols-3 gap-2 text-center" dir="ltr">
                                <button class="pos-btn" data-pos="top-left"><span class="material-symbols-rounded">north_west</span></button>
                                <button class="pos-btn" data-pos="top-center"><span class="material-symbols-rounded">north</span></button>
                                <button class="pos-btn" data-pos="top-right"><span class="material-symbols-rounded">north_east</span></button>
                                <button class="pos-btn" data-pos="middle-left"><span class="material-symbols-rounded">west</span></button>
                                <button class="pos-btn" data-pos="center"><span class="material-symbols-rounded">adjust</span></button>
                                <button class="pos-btn" data-pos="middle-right"><span class="material-symbols-rounded">east</span></button>
                                <button class="pos-btn" data-pos="bottom-left"><span class="material-symbols-rounded">south_west</span></button>
                                <button class="pos-btn" data-pos="bottom-center"><span class="material-symbols-rounded">south</span></button>
                                <button class="pos-btn" data-pos="bottom-right"><span class="material-symbols-rounded">south_east</span></button>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-col gap-2 mt-6 pt-4 border-t">
                        <button id="btn-print" class="w-full bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700 shadow-lg shadow-green-200 flex justify-center items-center gap-2 transition">
                            <span class="material-symbols-rounded">print</span>
                            طباعة / حفظ PDF
                        </button>
                        <button id="btn-new-photo" class="w-full bg-gray-100 text-gray-700 py-3 rounded-xl font-bold hover:bg-gray-200 transition">
                            صورة جديدة
                        </button>
                    </div>
                </div>

                <div class="print-container z-10 flex-1">
                    <div class="a4-sheet" dir="ltr">
                        <div id="print-sheet" class="print-safe-area">
                            </div>
                    </div>
                </div>

            </div>
        </section>

    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script src="script.js"></script>
</body>
</html>